# Dockit

Dead simple, yet powerful, authentication for any OCI registry.

## Registries

### Docker Distribution

Authentication with distribution is based on tokens and PKI, the x509 version of the public key has to be made available to the distribution instance upon start. Dockit comes with an init-container capability that will fetch all know keys and return them.

#### Configuration

It's fairly straight forward to configure the docker distribution registry to delegate authentication to Dockit.

The easiest and recommended method is via environment variables.

The following environment values should be set:

- `REGISTRY_AUTH_TOKEN_SERVICE` this is the name of your service
- `REGISTRY_AUTH_TOKEN_ISSUER` with value `dockit` (this is not optional)
- `REGISTRY_AUTH_TOKEN_REALM` this should be the https URL of where dockit is listening (example: <https://dockit.private.io/v2/token>)
- `REGISTRY_AUTH_TOKEN_ROOTCERTBUNDLE` should be set to `/dockit/certs.pem` (more below)

```json
{"token":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsIng1YyI6WyJNSUlDK1RDQ0FwK2dBd0lCQWdJQkFEQUtCZ2dxaGtqT1BRUURBakJHTVVRd1FnWURWUVFERXp0U1RVbEdPbEZNUmpRNlEwZFFNenBSTWtWYU9sRklSRUk2VkVkRlZUcFZTRlZNT2taTVZqUTZSMGRXV2pwQk5WUkhPbFJMTkZNNlVVeElTVEFlRncweU1qQXhNVEF5TWpJeE5EbGFGdzB5TXpBeE1qVXlNakl4TkRsYU1FWXhSREJDQmdOVkJBTVRPMUJaUTFJNlNWQmFRanBJUWxGWE9qZE1SVms2UWtGV1FqcEhTRGRhT2xWSVZ6TTZVa3RMVWpwRE4wNHpPbGxOTkZJNlNWaE5TRHBLVkZCQ01JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBbE5JOGFtMlBERnZzNndOeVl2d0dkZWZXVXJXQWdMZ3N2MzA2MnZycG5VNkN0WUpEZDZ2K2NEVG1FN1FlTllEaFMyaU1wU3djZkRCL2RFclEwdnhIZE4ycDIvODZmZy9TeWlIMnhmMGFVTjlDV1dud0JPaTIvS3hLditpbFNlQ01HYXRwRlg3SmYxcWI4N0Q5NUxOVDBvOU9OTmYxT3RidjY5ck9tL1RIVFh3clUvV3dTZlUyWktUbEw4SVRXRkRXN09ZK3hXdUJ0WUpteVhqcVpsaWRBbUNTdTdHY0Y0MVB5em9KTFFTMnJCdXJwOXc0cWgxMFk1bUNIcWdsaEI1Rk9aOUs0T2pUaVhUUHJFUk5WcnArUFVIR3JBYVRPRTBwQzgyUHBuWVZhNzNDUkdsMEdDdC9RckJwVjRpdmswdzF0eEtkV1NiSDNnRmtqZ2g1N0tOcDhRSURBUUFCbzRHeU1JR3ZNQTRHQTFVZER3RUIvd1FFQXdJSGdEQVBCZ05WSFNVRUNEQUdCZ1JWSFNVQU1FUUdBMVVkRGdROUJEdFFXVU5TT2tsUVdrSTZTRUpSVnpvM1RFVlpPa0pCVmtJNlIwZzNXanBWU0Zjek9sSkxTMUk2UXpkT016cFpUVFJTT2tsWVRVZzZTbFJRUWpCR0JnTlZIU01FUHpBOWdEdFNUVWxHT2xGTVJqUTZRMGRRTXpwUk1rVmFPbEZJUkVJNlZFZEZWVHBWU0ZWTU9rWk1WalE2UjBkV1dqcEJOVlJIT2xSTE5GTTZVVXhJU1RBS0JnZ3Foa2pPUFFRREFnTklBREJGQWlFQTdIY1VyVm1namo1cE01MXhZVHd2eGE1VnRqd2hub0dRZjFxTU52UGVHeVlDSUFwYm4vWFkvS1F5WWFWRnRjMWtsb0lmZzd4L3hlbkZhbkp4L0F2cURGdFgiXX0.eyJhY2Nlc3MiOltdLCJhdWQiOiJyZWdpc3RyeS5kb2NrZXIuaW8iLCJleHAiOjE2NDk1Mjk3NjYsImlhdCI6MTY0OTUyOTQ2NiwiaXNzIjoiYXV0aC5kb2NrZXIuaW8iLCJqdGkiOiJINDk4MXNON01FQUttLWZROUtOcyIsIm5iZiI6MTY0OTUyOTE2Niwic3ViIjoiIn0.eJm-xHlT9y6bjkpUg8ZXmCngYaUda4M7Uik7FI02XZFNK72PWIeJC7OSdOlGf3GAcvh_bjsk2QsTiZtC5HJRGZEZMzoWqLpSsNHRk8vM4BdJjQmr7EAasBT0yDqVj_-I8MxO0tbEPxwXGoINxcfhfNe99H0scO_SD-a7q9G1DivfiIYup3J4WiJTCchUvJaUOdhSjcaURIk65ZEXHuQrf8cS8r2TsIeIv4a3Cm7RuiVZAekYPVe_6P0D2-JosIKoKCduj4-2Ftfoqh_3BguNmn-hZ2X3TQlIhUQDY-n8F-CS1w8klXcOQcpiI00W7JS_d_5lCGl6w3d0qgcf6LEjxA","access_token":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsIng1YyI6WyJNSUlDK1RDQ0FwK2dBd0lCQWdJQkFEQUtCZ2dxaGtqT1BRUURBakJHTVVRd1FnWURWUVFERXp0U1RVbEdPbEZNUmpRNlEwZFFNenBSTWtWYU9sRklSRUk2VkVkRlZUcFZTRlZNT2taTVZqUTZSMGRXV2pwQk5WUkhPbFJMTkZNNlVVeElTVEFlRncweU1qQXhNVEF5TWpJeE5EbGFGdzB5TXpBeE1qVXlNakl4TkRsYU1FWXhSREJDQmdOVkJBTVRPMUJaUTFJNlNWQmFRanBJUWxGWE9qZE1SVms2UWtGV1FqcEhTRGRhT2xWSVZ6TTZVa3RMVWpwRE4wNHpPbGxOTkZJNlNWaE5TRHBLVkZCQ01JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBbE5JOGFtMlBERnZzNndOeVl2d0dkZWZXVXJXQWdMZ3N2MzA2MnZycG5VNkN0WUpEZDZ2K2NEVG1FN1FlTllEaFMyaU1wU3djZkRCL2RFclEwdnhIZE4ycDIvODZmZy9TeWlIMnhmMGFVTjlDV1dud0JPaTIvS3hLditpbFNlQ01HYXRwRlg3SmYxcWI4N0Q5NUxOVDBvOU9OTmYxT3RidjY5ck9tL1RIVFh3clUvV3dTZlUyWktUbEw4SVRXRkRXN09ZK3hXdUJ0WUpteVhqcVpsaWRBbUNTdTdHY0Y0MVB5em9KTFFTMnJCdXJwOXc0cWgxMFk1bUNIcWdsaEI1Rk9aOUs0T2pUaVhUUHJFUk5WcnArUFVIR3JBYVRPRTBwQzgyUHBuWVZhNzNDUkdsMEdDdC9RckJwVjRpdmswdzF0eEtkV1NiSDNnRmtqZ2g1N0tOcDhRSURBUUFCbzRHeU1JR3ZNQTRHQTFVZER3RUIvd1FFQXdJSGdEQVBCZ05WSFNVRUNEQUdCZ1JWSFNVQU1FUUdBMVVkRGdROUJEdFFXVU5TT2tsUVdrSTZTRUpSVnpvM1RFVlpPa0pCVmtJNlIwZzNXanBWU0Zjek9sSkxTMUk2UXpkT016cFpUVFJTT2tsWVRVZzZTbFJRUWpCR0JnTlZIU01FUHpBOWdEdFNUVWxHT2xGTVJqUTZRMGRRTXpwUk1rVmFPbEZJUkVJNlZFZEZWVHBWU0ZWTU9rWk1WalE2UjBkV1dqcEJOVlJIT2xSTE5GTTZVVXhJU1RBS0JnZ3Foa2pPUFFRREFnTklBREJGQWlFQTdIY1VyVm1namo1cE01MXhZVHd2eGE1VnRqd2hub0dRZjFxTU52UGVHeVlDSUFwYm4vWFkvS1F5WWFWRnRjMWtsb0lmZzd4L3hlbkZhbkp4L0F2cURGdFgiXX0.eyJhY2Nlc3MiOltdLCJhdWQiOiJyZWdpc3RyeS5kb2NrZXIuaW8iLCJleHAiOjE2NDk1Mjk3NjYsImlhdCI6MTY0OTUyOTQ2NiwiaXNzIjoiYXV0aC5kb2NrZXIuaW8iLCJqdGkiOiJINDk4MXNON01FQUttLWZROUtOcyIsIm5iZiI6MTY0OTUyOTE2Niwic3ViIjoiIn0.eJm-xHlT9y6bjkpUg8ZXmCngYaUda4M7Uik7FI02XZFNK72PWIeJC7OSdOlGf3GAcvh_bjsk2QsTiZtC5HJRGZEZMzoWqLpSsNHRk8vM4BdJjQmr7EAasBT0yDqVj_-I8MxO0tbEPxwXGoINxcfhfNe99H0scO_SD-a7q9G1DivfiIYup3J4WiJTCchUvJaUOdhSjcaURIk65ZEXHuQrf8cS8r2TsIeIv4a3Cm7RuiVZAekYPVe_6P0D2-JosIKoKCduj4-2Ftfoqh_3BguNmn-hZ2X3TQlIhUQDY-n8F-CS1w8klXcOQcpiI00W7JS_d_5lCGl6w3d0qgcf6LEjxA","expires_in":300,"issued_at":"2022-04-09T18:37:46.995938994Z"}
```

```json
{
  "alg": "RS256",
  "typ": "JWT",
  "x5c": [
    "MIIC+TCCAp+gAwIBAgIBADAKBggqhkjOPQQDAjBGMUQwQgYDVQQDEztSTUlGOlFMRjQ6Q0dQMzpRMkVaOlFIREI6VEdFVTpVSFVMOkZMVjQ6R0dWWjpBNVRHOlRLNFM6UUxISTAeFw0yMjAxMTAyMjIxNDlaFw0yMzAxMjUyMjIxNDlaMEYxRDBCBgNVBAMTO1BZQ1I6SVBaQjpIQlFXOjdMRVk6QkFWQjpHSDdaOlVIVzM6UktLUjpDN04zOllNNFI6SVhNSDpKVFBCMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAlNI8am2PDFvs6wNyYvwGdefWUrWAgLgsv3062vrpnU6CtYJDd6v+cDTmE7QeNYDhS2iMpSwcfDB/dErQ0vxHdN2p2/86fg/SyiH2xf0aUN9CWWnwBOi2/KxKv+ilSeCMGatpFX7Jf1qb87D95LNT0o9ONNf1Otbv69rOm/THTXwrU/WwSfU2ZKTlL8ITWFDW7OY+xWuBtYJmyXjqZlidAmCSu7GcF41PyzoJLQS2rBurp9w4qh10Y5mCHqglhB5FOZ9K4OjTiXTPrERNVrp+PUHGrAaTOE0pC82PpnYVa73CRGl0GCt/QrBpV4ivk0w1txKdWSbH3gFkjgh57KNp8QIDAQABo4GyMIGvMA4GA1UdDwEB/wQEAwIHgDAPBgNVHSUECDAGBgRVHSUAMEQGA1UdDgQ9BDtQWUNSOklQWkI6SEJRVzo3TEVZOkJBVkI6R0g3WjpVSFczOlJLS1I6QzdOMzpZTTRSOklYTUg6SlRQQjBGBgNVHSMEPzA9gDtSTUlGOlFMRjQ6Q0dQMzpRMkVaOlFIREI6VEdFVTpVSFVMOkZMVjQ6R0dWWjpBNVRHOlRLNFM6UUxISTAKBggqhkjOPQQDAgNIADBFAiEA7HcUrVmgjj5pM51xYTwvxa5VtjwhnoGQf1qMNvPeGyYCIApbn/XY/KQyYaVFtc1kloIfg7x/xenFanJx/AvqDFtX"
  ]
}
```

```json
{
  "access": [],
  "aud": "registry.docker.io",
  "exp": 1649529766,
  "iat": 1649529466,
  "iss": "auth.docker.io",
  "jti": "H4981sN7MEAKm-fQ9KNs",
  "nbf": 1649529166,
  "sub": ""
}
```
